<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Photo IA ‚Äî MVP</title>

  <!-- Tailwind CSS (sans build) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    /* Petit ‚Äúgrain‚Äù premium + safe-area iPhone */
    body { padding-bottom: env(safe-area-inset-bottom); }
  </style>
</head>

<body class="bg-zinc-950 text-zinc-50 min-h-screen">
  <div class="max-w-md mx-auto px-4 py-6">
    <!-- Header -->
    <div class="flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="w-10 h-10 rounded-2xl bg-zinc-800 grid place-items-center text-lg">‚öΩÔ∏è</div>
        <div>
          <div class="text-lg font-semibold leading-tight">Photo IA</div>
          <div class="text-xs text-zinc-400">Prototype matchday (d√©mo)</div>
        </div>
      </div>
      <span class="text-xs px-3 py-1 rounded-full bg-zinc-800 text-zinc-200">Preview prot√©g√©e</span>
    </div>

    <!-- Hero -->
    <div class="mt-6 rounded-3xl bg-gradient-to-b from-zinc-900 to-zinc-950 border border-zinc-800 p-5">
      <h1 class="text-2xl font-bold">Ta photo ‚Äúcomme si‚Äù tu √©tais avec les joueurs</h1>
      <p class="mt-2 text-sm text-zinc-300">
        1) Choisis une photo  2) On g√©n√®re un aper√ßu prot√©g√©  3) Paiement ‚Üí HD (bient√¥t)
      </p>
    </div>

    <!-- Pack -->
    <div class="mt-5 rounded-3xl border border-zinc-800 bg-zinc-900/40 p-5">
      <div class="text-sm font-semibold">Choisis ton pack</div>
      <p class="text-xs text-zinc-400 mt-1">Les prix sont indicatifs (simulation).</p>

      <select id="pack" class="mt-3 w-full rounded-2xl bg-zinc-950 border border-zinc-800 px-4 py-3 text-sm">
        <option value="solo">Solo ‚Äî 1 photo (5‚Ç¨)</option>
        <option value="duo">Duo ‚Äî 2 photos (8‚Ç¨)</option>
        <option value="famille">Famille ‚Äî 4 photos (12‚Ç¨)</option>
        <option value="tribu">Tribu ‚Äî 6 photos (15‚Ç¨)</option>
      </select>

      <div class="mt-4 grid grid-cols-2 gap-3 text-xs text-zinc-300">
        <div class="rounded-2xl bg-zinc-950/70 border border-zinc-800 p-3">
          ‚úÖ Aper√ßu imm√©diat
          <div class="text-zinc-500 mt-1">Watermark + compression</div>
        </div>
        <div class="rounded-2xl bg-zinc-950/70 border border-zinc-800 p-3">
          üîí HD apr√®s achat
          <div class="text-zinc-500 mt-1">T√©l√©chargement + options</div>
        </div>
      </div>
    </div>

    <!-- Upload -->
    <div class="mt-5 rounded-3xl border border-zinc-800 bg-zinc-900/40 p-5">
      <div class="text-sm font-semibold">Ajoute ta photo</div>
      <p class="text-xs text-zinc-400 mt-1">Cam√©ra ou galerie (iPhone OK).</p>

      <input id="photo" type="file" accept="image/*" capture="environment"
        class="mt-3 block w-full text-sm
               file:mr-4 file:rounded-xl file:border-0
               file:bg-zinc-800 file:px-4 file:py-3 file:text-zinc-100
               file:hover:bg-zinc-700" />

      <button id="sendBtn"
        class="mt-4 w-full rounded-2xl bg-white text-zinc-950 font-semibold py-4 active:scale-[0.99] transition">
        G√©n√©rer mon aper√ßu
      </button>

      <div id="status" class="mt-3 text-xs text-zinc-300"></div>
    </div>

    <!-- Preview -->
    <div class="mt-5 rounded-3xl border border-zinc-800 bg-zinc-900/40 p-5">
      <div class="flex items-center justify-between">
        <div class="text-sm font-semibold">Aper√ßu</div>
        <span class="text-xs text-zinc-400">prot√©g√©</span>
      </div>

      <img id="preview" alt="aper√ßu"
           class="mt-4 w-full rounded-3xl border border-zinc-800 hidden" />

      <button id="unlock"
        class="mt-4 w-full rounded-2xl bg-zinc-800 text-zinc-200 font-semibold py-4 hover:bg-zinc-700 hidden">
        D√©bloquer HD (bient√¥t)
      </button>

      <div class="mt-3 text-[11px] text-zinc-500 leading-snug">
        * Sur la version finale : paiement ‚Üí image HD sans watermark, et option tirage papier.
      </div>
    </div>

    <!-- Footer -->
    <div class="mt-8 text-center text-xs text-zinc-500">
      D√©mo technique ‚Äî pour validation concept & exp√©rience spectateur.
    </div>
  </div>

  <script>
    const pack = document.getElementById("pack");
    const input = document.getElementById("photo");
    const sendBtn = document.getElementById("sendBtn");
    const status = document.getElementById("status");
    const preview = document.getElementById("preview");
    const unlock = document.getElementById("unlock");

    sendBtn.onclick = async () => {
      const file = input.files?.[0];
      if (!file) { alert("Choisis une photo."); return; }

      status.textContent = `Upload‚Ä¶ (${Math.round(file.size/1024/1024)} MB)`;
      preview.classList.add("hidden");
      unlock.classList.add("hidden");

      try {
        const fd = new FormData();
        fd.append("photo", file);
        fd.append("pack", pack.value);

        const res = await fetch("/api/upload", { method: "POST", body: fd });
        const data = await res.json().catch(() => ({}));

        if (!res.ok) {
          status.textContent = "Erreur : " + (data?.error || `HTTP ${res.status}`);
          return;
        }

        status.textContent = "Aper√ßu g√©n√©r√© ‚úÖ";
        // IMPORTANT : ?t= pour √©viter le cache Safari
        preview.src = data.previewUrl + "?t=" + Date.now();
        preview.classList.remove("hidden");
        unlock.classList.remove("hidden");

        unlock.onclick = () => {
          alert("Paiement + HD arrive bient√¥t üôÇ (on le branche apr√®s)");
        };
      } catch (e) {
        status.textContent = "Erreur : " + (e?.message || "inconnue");
      }
    };
  </script>
</body>
</html>

